<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=5" />
  <title>Oradia – Tirage du Tore</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'night-blue': '#0a192f',
            'gold': '#d4af37',
            'light-gold': '#f5e7a1',
            'dark-blue': '#051428',
            'celtic-blue': '#1a365d'
          },
          fontFamily: {
            'cormorant': ['Cormorant Garamond', 'serif'],
            'poppins': ['Poppins', 'sans-serif']
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap');

    :root {
      --dore:#d4af37;
      --text:#e9e7df;
    }

    body {
      margin:0;
      font-family:'Poppins',sans-serif;
      background:#0a192f;
      color:#f5e7a1;
    }

    .cormorant { font-family:'Cormorant Garamond', serif; }
    .bg-night-blue { background-color:#0a192f; }
    .text-gold { color:#d4af37; }
    .text-light-gold { color:#f5e7a1; }

    .btn-gold {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:0.75rem 1.5rem;
      border-radius:9999px;
      background:linear-gradient(90deg,#d4af37,#f5e7a1,#d4af37);
      background-size:200% 200%;
      color:#051428;
      font-weight:600;
      font-size:0.95rem;
      box-shadow:0 10px 30px rgba(0,0,0,.45);
      border:none;
      cursor:pointer;
      transition:transform .2s, box-shadow .2s, background-position .4s;
      text-decoration:none;
    }
    .btn-gold:hover {
      transform:translateY(-1px);
      box-shadow:0 15px 40px rgba(0,0,0,.6);
      background-position:100% 0;
    }

    .gold-gradient {
      background:linear-gradient(90deg,#d4af37,#f5e7a1,#d4af37);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }

    .container {
      max-width:1200px;
      margin:0 auto;
    }
  </style>
</head>
<body class="bg-night-blue text-light-gold">
<header class="bg-[rgba(5,20,40,0.8)] py-4 shadow-lg backdrop-blur-lg border-b border-gold/20">
  <div class="container mx-auto flex items-center justify-between px-4 md:px-6">

    <!-- LOGO -->
    <a href="index.html#accueil" class="flex items-center gap-4">
      <img src="images/logo-hd-v2.jpeg" alt="Oradia Logo"
     class="w-16 h-16 object-contain transform hover:scale-110 transition-transform duration-300" />
      <span class="cormorant text-3xl font-bold gold-gradient">ORADIA</span>
    </a>

    <!-- NAVIGATION -->
    <nav class="hidden md:flex items-center space-x-8 text-gold font-medium">
      <a href="index.html#accueil" class="hover:text-light-gold transition">
        <i class="fas fa-home mr-2"></i>Accueil
      </a>
      <a href="index.html#offres" class="hover:text-light-gold transition">
        <i class="fas fa-tags mr-2"></i>Offres
      </a>
      <a href="index.html#Jeu" class="hover:text-light-gold transition">
        <i class="fas fa-dice mr-2"></i>Jeu
      </a>
      <a href="index.html#edolgor" class="hover:text-light-gold transition">
        <i class="fas fa-handshake mr-2"></i>Partenariat
      </a>
      <a href="index.html#apropos" class="hover:text-light-gold transition">
        <i class="fas fa-info-circle mr-2"></i>À Propos
      </a>
    </nav>

    <!-- ESPACE MEMBRE -->
    <div id="memberMenuWrapper" class="hidden md:block relative">
      <button id="memberMenuBtn" class="flex items-center gap-2 text-gold font-medium hover:text-light-gold transition">
        <i class="fas fa-user-circle text-2xl"></i>
        <span>Espace membre</span>
        <i class="fas fa-chevron-down text-sm ml-1"></i>
      </button>

      <div id="memberDropdown"
           class="hidden absolute right-0 mt-2 w-48 bg-[rgba(5,20,40,0.95)] border border-gold/30 rounded-lg shadow-lg z-50 backdrop-blur-md">
        <a href="profil.html" class="block px-4 py-2 text-gold hover:bg-gold/10">Profil</a>
        <a href="dashboard.html" class="block px-4 py-2 text-gold hover:bg-gold/10">Tableau de bord</a>
        <button id="logoutBtn" class="w-full text-left px-4 py-2 text-gold hover:bg-gold/10">Déconnexion</button>
      </div>
    </div>

    <!-- MENU MOBILE -->
    <button id="mobileMenuBtn" class="md:hidden text-gold text-3xl focus:outline-none">
      <i class="fas fa-bars"></i>
    </button>
  </div>

  <div id="mobileMenu"
       class="hidden flex-col items-center md:hidden bg-[rgba(5,20,40,0.95)] border-t border-gold/20 py-6 space-y-4 text-gold font-medium">
    <a href="index.html#accueil" class="hover:text-light-gold transition">Accueil</a>
    <a href="index.html#offres" class="hover:text-light-gold transition">Offres</a>
    <a href="index.html#Jeu" class="hover:text-light-gold transition">Jeu</a>
    <a href="index.html#edolgor" class="hover:text-light-gold transition">Partenariat</a>
    <a href="index.html#apropos" class="hover:text-light-gold transition">À Propos</a>
  </div>
</header>


<!-- ================== TIRAGE DU TORE – PAGE IMMERSIVE ================== -->

<style>
  /* Mode immersif : on cache le reste quand le tirage est lancé */
  body.hide-immersive-tore > header,
  body.hide-immersive-tore > footer,
  body.hide-immersive-tore > section:not(#tore-immersif) {
    display: none !important;
  }

/* ===== PLATEAU DU TIRAGE DU TORE ===== */
#tore-immersif .tore-board-7 {
  position: relative;
  width: min(1400px, 95vw);
  aspect-ratio: 1 / 1;
  margin: 0 auto;

  /* un peu moins de marge interne pour laisser plus de place aux cartes */
  padding: 7% 10%;

  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  grid-template-areas:
    "top-left   .        top-right"
    "mid-left   center   mid-right"
    "bottom-left .       bottom-right";
  gap: 2.4rem;                 /* plus d’espace entre les piles */
  place-items: center;

  background-image: url("images/plateau.jpeg");
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
}


/* Mapping des 7 cartes sur le plateau */
.tore-card.pos-0 { grid-area: top-left; }
.tore-card.pos-1 { grid-area: top-right; }
.tore-card.pos-2 { grid-area: bottom-left; }
.tore-card.pos-3 { grid-area: mid-left; }
.tore-card.pos-4 { grid-area: center; }
.tore-card.pos-5 { grid-area: mid-right; }
.tore-card.pos-6 { grid-area: bottom-right; }

/* Ajustements du plateau */

/* Émotions + Besoins → légèrement vers le bas */
.tore-card.pos-0,
.tore-card.pos-1 {
  transform: translateY(-2%);
}

/* Transmutation → décalé encore plus à gauche */
.tore-card.pos-2 {
  transform: translate(-70px, -30px);   /* X = -30px pour aller à gauche */
}

/* Mémoire Cosmos (centre) */
.tore-card.pos-6 {
  transform: translateY(-110%);
}

/* Archétype → décalé plus à droite */
.tore-card.pos-4 {
  transform: translate(70px, -30px);     /* X = +30px pour aller à droite */
}


  /* Disposition des piles :
     Ligne 1 : Révélation (gauche)          [pos-5]
               (rien au centre)
               Action (droite)             [pos-3]
     Ligne 2 : Transmutation (gauche)      [pos-2]
               Mémoire Cosmos (centre)     [pos-6]
               Archétype (droite)          [pos-4]
     Ligne 3 : Émotions (gauche)           [pos-0]
               (rien au centre)
               Besoin (droite)             [pos-1]
  */
  #tore-immersif .tore-board-7 .pos-5 { grid-area: 1 / 1; }
  #tore-immersif .tore-board-7 .pos-3 { grid-area: 1 / 3; }
  #tore-immersif .tore-board-7 .pos-2 { grid-area: 2 / 1; }
  #tore-immersif .tore-board-7 .pos-6 { grid-area: 2 / 2; }
  #tore-immersif .tore-board-7 .pos-4 { grid-area: 2 / 3; }
  #tore-immersif .tore-board-7 .pos-0 { grid-area: 3 / 1; }
  #tore-immersif .tore-board-7 .pos-1 { grid-area: 3 / 3; }

#tore-board {
  position: relative;
}

/* Cartes un peu plus petites pour rentrer pile dans les cadres */
.tore-card{
  width: clamp(170px, 17vw, 230px); /* taille stable = moins de collisions */
  aspect-ratio: 64 / 90;
  height: auto;
  perspective: 1000px;
  position: relative;
}

  @media (max-width: 860px) {
    #tore-immersif .tore-board-7 {
      grid-template-columns: 1fr;
      grid-template-rows: auto;
    }
    #tore-immersif .tore-board-7 .pos-0,
    #tore-immersif .tore-board-7 .pos-1,
    #tore-immersif .tore-board-7 .pos-2,
    #tore-immersif .tore-board-7 .pos-3,
    #tore-immersif .tore-board-7 .pos-4,
    #tore-immersif .tore-board-7 .pos-5,
    #tore-immersif .tore-board-7 .pos-6 {
      grid-area: auto;
    }
  }
  .tore-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border-radius: 18px;
    box-shadow: 0 20px 40px rgba(0,0,0,45);
  }
  .tore-card.flipped .tore-card-inner {
    transform: rotateY(180deg);
  }
.tore-card-back,
  .tore-card-front {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: 18px;
    overflow: hidden;
    border: 1px solid rgba(212,175,55,45);
  }

   .tore-card-back {
    background-color: #020817;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    cursor: pointer;
  }

  /* Dos par famille */

  .tore-card[data-family="emotions"] .tore-card-back {
    background-image: url("images/dos/dos_emotion.png");
  }

  .tore-card[data-family="besoins"] .tore-card-back {
    background-image: url("images/dos/dos_besoin.png");
  }

  .tore-card[data-family="transmutation"] .tore-card-back {
    background-image: url("images/dos/dos_transmutation.png");
  }

  .tore-card[data-family="actions"] .tore-card-back {
    background-image: url("images/dos/dos_action.png");
  }

  .tore-card[data-family="archetypes"] .tore-card-back {
    background-image: url("images/dos/dos_archetype.png");
  }

  .tore-card[data-family="revelations"] .tore-card-back {
    background-image: url("images/dos/dos_revelation.png");
  }

  .tore-card[data-family="memoire_cosmos"] .tore-card-back {
    background-image: url("images/dos/dos_memoire_cosmos.png");
  }

  /* Label de famille sous chaque tas */
.tore-family-label {
  position: absolute;
  left: 50%;
  bottom: -2.2rem;             /* sous la carte */
  transform: translateX(-50%);
  padding: 4px 14px 5px;
  border-radius: 999px;
  border: 1px solid rgba(212,175,55,0.55);
  background: radial-gradient(circle at 50% 0%, rgba(10,26,52,0.95), rgba(2,8,20,0.92));
  color: #f5e7a1;
  font-family: "Cinzel", serif;
  font-size: 0.8rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  white-space: nowrap;
  text-shadow: 0 0 8px rgba(0,0,0,0.8);
  pointer-events: none;        /* on ne gêne pas les clics sur la carte */
}

/* Centre du Tore : on descend un peu plus pour ne pas coller au cercle */
.tore-card.pos-7 .tore-family-label {
  bottom: -2.7rem;
}

   .tore-card-front {
    transform: rotateY(180deg);
    background: radial-gradient(circle at 20% 0%, rgba(245,231,161,15), transparent 55%),
                radial-gradient(circle at 80% 100%, rgba(88,190,255,12), transparent 55%),
                linear-gradient(160deg,#071426,#020814,#050b18);
    display: flex;
    flex-direction: column;
    padding: 16px 18px;
    color: #f9f7ef;
    position: relative;

  }
  .tore-card-front .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: .8rem;
    margin-bottom: 12px;
  }
  .tore-card-front .chip {
    border-radius: 999px;
    border: 1px solid rgba(212,175,55,75);
    padding: 4px 10px;
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: .14em;
    font-size: .72rem;
  }
  .tore-card-front .polarity {
    font-size: 1.1rem;
  }
  .tore-card-front .art {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 0 6px;
  }
  .tore-card-front [data-name] {
    font-family: "Cormorant Garamond", serif;
    font-size: 1.6rem;
    margin-bottom: .3rem;
  }
  .tore-card-front [data-quote] {
    font-size: .93rem;
    line-height: 1.4;
    opacity: .9;
  }
    

  /* Feedback visuel match / mismatch */
  .tore-card.match .tore-card-inner {
    box-shadow: 0 0 0 2px rgba(80,200,120,0.9), 0 18px 40px rgba(0,0,0,0.75);
  }
  .tore-card.mismatch .tore-card-inner {
    box-shadow: 0 0 0 2px rgba(231,76,60,0.95), 0 18px 40px rgba(0,0,0,0.75);
  }

  /* Cartes supplémentaires (famille suivante) */
  .tore-extra-cards {
    position: absolute;
    bottom: -10px;
    right: -20px;
    display: flex;
    gap: 6px;
    pointer-events: none;
  }
  .tore-extra-card {
    width: 80px;
    aspect-ratio: 64 / 90;
    border-radius: 12px;
    border: 1px solid rgba(212,175,55,0.7);
    box-shadow: 0 12px 24px rgba(0,0,0,0.75);
    transform: translateY(-6px) rotate(-4deg);
    opacity: 0;
    transition: opacity 0.25s ease, transform 0.25s ease;
  }
  .tore-extra-card.show {
    opacity: 1;
    transform: translateY(0) rotate(0deg);
  }

  /* Flèche coin → carte */
  #tore-arrow {
    position: fixed;
    height: 3px;
    width: 0;
    background: linear-gradient(90deg, #d4af37, #f5e7a1);
    transform-origin: 0 50%;
    pointer-events: none;
    opacity: 0;
    z-index: 70;
    transition: opacity 0.25s ease, transform 0.35s ease, width 0.35s ease;
  }
  #tore-arrow::after {
    content: "";
    position: absolute;
    right: -8px;
    top: 50%;
    transform: translateY(-50%);
    border-style: solid;
    border-width: 6px 0 6px 10px;
    border-color: transparent transparent transparent #f5e7a1;
  }
  /* Couleurs dynamiques de la flèche (1 seule flèche) */
  #tore-arrow.match {
    background: rgba(46,204,113,0.95);
  }
  #tore-arrow.match::after {
    border-color: transparent transparent transparent rgba(46,204,113,0.95);
  }

  #tore-arrow.mismatch {
    background: rgba(231,76,60,0.95);
  }
  #tore-arrow.mismatch::after {
    border-color: transparent transparent transparent rgba(231,76,60,0.95);
  }

  #tore-immersif .container {
  max-width: 1500px;   /* augmente la largeur du cadre */
}

  /* ========================
     PIÈCE DE TIRAGE ORADIA
     ======================== */

   .tore-coin {
    width: 110px;
    height: 110px;
    border-radius: 999px;
    background-image: url("images/coin-oradia.png");
    background-size: 200% 100%;        /* 2 faces côte à côte */
    background-position: left center;  /* face Yang par défaut */
    box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    border: 1px solid rgba(212,175,55,0.7);
    cursor: pointer;
    transform-style: preserve-3d;
    transition: transform 0.3s ease;
    position: relative;                /* pour les pseudo-éléments */
    overflow: visible;
  }

  /* halo + onde autour de la pièce */
  .tore-coin::before,
  .tore-coin::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 999px;
    pointer-events: none;
  }

  /* halo pulsant (actif quand .glow est présent) */
  .tore-coin::before {
    opacity: 0;
    box-shadow: 0 0 0 0 rgba(212,175,55,0.0);
    transform: scale(1);
  }
  .tore-coin.glow::before {
    animation: coin-glow 1.8s ease-in-out infinite;
  }

  /* onde circulaire (actif quand .ripple est présent) */
  .tore-coin::after {
    opacity: 0;
    border: 2px solid rgba(212,175,55,0.8);
    transform: scale(1);
  }
  .tore-coin.ripple::after {
    animation: coin-ripple 0.8s ease-out forwards;
  }


  /* Faces : gauche = Yang (triangle), droite = Yin (cercle) */
  .tore-coin.face-yang {
    background-position: left center;
  }

  .tore-coin.face-yin {
    background-position: right center;
  }

  /* Animation de lancer */
  .tore-coin.spin {
    animation: coin-spin 1s ease-in-out;
  }

  @keyframes coin-spin {
    0%   { transform: rotateY(0deg) scale(1); }
    35%  { transform: rotateY(360deg) scale(1.25); }
    70%  { transform: rotateY(720deg) scale(1.05); }
    100% { transform: rotateY(1080deg) scale(1); }
  }
  @keyframes coin-glow {
    0% {
      opacity: 0.15;
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(212,175,55,0.0);
    }
    50% {
      opacity: 0.6;
      transform: scale(1.35);
      box-shadow: 0 0 40px 12px rgba(212,175,55,0.35);
    }
    100% {
      opacity: 0.15;
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(212,175,55,0.0);
    }
  }

  @keyframes coin-ripple {
    0% {
      opacity: 0.7;
      transform: scale(1);
    }
    80% {
      opacity: 0.4;
      transform: scale(2.3);
    }
    100% {
      opacity: 0;
      transform: scale(2.6);
    }
  }

  /* Aperçu zoom des cartes retournées – version douce */
  #card-preview-overlay {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0); /* transparent au repos */
    z-index: 60;
    pointer-events: none;       /* ne bloque pas la souris */
    opacity: 0;
    transition: opacity 0.4s ease, background 0.4s ease;
  }

  /* Quand le zoom est actif */
  #card-preview-overlay.card-preview-visible {
    opacity: 1;
    background: rgba(0,0,0,0.6);
  }

  #card-preview-overlay img {
    max-width: min(480px, 90vw);
    height: auto;
    border-radius: 18px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    border: 1px solid rgba(212,175,55,.7);
    transform: scale(0.9);
    opacity: 0;
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  #card-preview-overlay.card-preview-visible img {
    transform: scale(1);
    opacity: 1;
  }

  /* Plateau verrouillé pendant que la pièce tourne */
  #tore-immersif .tore-board-7.board-locked,
  #tore-immersif .tore-board-7.board-locked * {
    pointer-events: none !important;
    cursor: default;
  }
/* Vibration subtile du tore */
@keyframes tore-shake {
  0%   { transform: translate(0, 0); }
  25%  { transform: translate(-3px, 1px); }
  50%  { transform: translate(3px, -1px); }
  75%  { transform: translate(-2px, 2px); }
  100% { transform: translate(0, 0); }
}

.tore-shake {
  animation: tore-shake 0.25s ease-out;
}
/* Flèche entre carte et pièce */
.tore-arrow {
  position: absolute;
  top: 14%;
  right: -70px;
  width: 60px;
  height: 2px;
  background: rgba(212,175,55,0.85);
  transform-origin: left center;
  opacity: 0;
  animation: tore-arrow-appear 0.6s ease-out forwards;
}

.tore-arrow::after {
  content: "";
  position: absolute;
  right: -6px;
  top: 50%;
  transform: translateY(-50%);
  border-top: 5px solid transparent;
  border-bottom: 5px solid transparent;
  border-left: 8px solid currentColor;
}
/* --- OVERLAY TIRAGE PASSERELLE --- */

#tore-extra-overlay {
  position: fixed;
  inset: 0;
  background: rgba(2, 6, 23, 0.92);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.tore-extra-panel {
  position: relative;
  padding: 24px 32px 32px;
  border-radius: 18px;
  background: radial-gradient(circle at top, rgba(15,23,42,0.95), rgba(2,6,23,0.98));
  border: 1px solid rgba(212,175,55,0.7);
  box-shadow: 0 24px 80px rgba(0,0,0,0.85);
  color: #f9fafb;
  text-align: center;
  max-width: 560px;
  width: 90%;
}

.tore-extra-panel h3 {
  margin: 0;
  font-size: 18px;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: #e5e7eb;
}

.tore-extra-panel p {
  margin: 10px 0 0;
  font-size: 14px;
  color: #cbd5f5;
}

/* éventail */

.tore-extra-fan {
  position: relative;
  height: 200px;
  margin-top: 26px;
  margin-bottom: 18px;
}

.tore-fan-card {
  position: absolute;
  top: 22px;
  left: 50%;
  width: 90px;
  height: 140px;
  margin-left: -45px;
  border-radius: 10px;
  background: radial-gradient(circle at 18% 8%, rgba(255,255,255,0.35), rgba(15,23,42,1));
  border: 1px solid rgba(212,175,55,0.8);
  box-shadow: 0 12px 35px rgba(0,0,0,0.85);
  transform-origin: bottom center;
  cursor: pointer;
  transition: transform 0.25s ease-out, box-shadow 0.25s ease-out, top 0.25s ease-out;
}

.tore-fan-card:hover {
  top: 6px;
  box-shadow: 0 18px 48px rgba(0,0,0,0.9);
}

/* 5 cartes en éventail */
.tore-fan-card:nth-child(1) { transform: rotate(-22deg) translateX(-82px); }
.tore-fan-card:nth-child(2) { transform: rotate(-11deg) translateX(-40px); }
.tore-fan-card:nth-child(3) { transform: rotate(0deg); }
.tore-fan-card:nth-child(4) { transform: rotate(11deg) translateX(40px); }
.tore-fan-card:nth-child(5) { transform: rotate(22deg) translateX(82px); }

/* bouton annuler (optionnel) */
.tore-extra-cancel {
  margin-top: 4px;
  padding: 6px 14px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,0.85);
  background: transparent;
  color: #e5e7eb;
  font-size: 13px;
  letter-spacing: .04em;
  text-transform: uppercase;
  cursor: pointer;
}

.tore-extra-cancel:hover {
  background: rgba(15,23,42,0.9);
}

/* vert si même polarité, rouge si différent */
.tore-arrow.match {
  color: #2ecc71;
  background: rgba(46,204,113,0.9);
}

.tore-arrow.mismatch {
  color: #e74c3c;
  background: rgba(231,76,60,0.9);
}

@keyframes tore-arrow-appear {
  0% {
    opacity: 0;
    transform: scaleX(0);
  }
  100% {
    opacity: 1;
    transform: scaleX(1);
  }
}

/* Carte supplémentaire (famille suivante) en cas de passerelle */
.tore-card-extra {
  position: absolute;
  top: 10%;
  left: 10%;
  width: 45%;
  aspect-ratio: 64 / 90;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid rgba(212,175,55,0.85);
  box-shadow: 0 12px 25px rgba(0,0,0,0.6);
  transform: translate(14px, -14px) scale(0.9);
  opacity: 0;
  background: #020817;
  animation: tore-extra-appear 0.45s ease-out forwards;
  z-index: 5;
}

.tore-card-extra img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

@keyframes tore-extra-appear {
  0% {
    opacity: 0;
    transform: translate(0, 0) scale(0.2);
  }
  100% {
    opacity: 1;
    transform: translate(14px, -14px) scale(0.9);
  }
}

</style>

<section id="tore-immersif" class="py-20 px-6 bg-night-blue">
  <div class="container mx-auto max-w-6xl">
    <div class="text-center mb-12">
      <h1 class="cormorant text-4xl md:text-5xl font-bold mb-4 gold-gradient pb-1">
        Tirage du TORE
      </h1>
      <p class="text-light-gold max-w-3xl mx-auto">
        Guidance vibratoire complète.
      </p>
    </div>

    <div class="rounded-2xl p-8 mb-8 relative overflow-hidden"
         style="background:linear-gradient(145deg,rgba(26,54,93,.8),rgba(5,20,40,.9));border:1px solid rgba(212,175,55,.3)">

      <!-- Bouton retour mode immersif -->
      <button id="exitToreBtn"
              class="fixed top-4 left-4 hidden z-50 bg-gold text-night-blue font-bold px-4 py-2 rounded-lg shadow-lg">
        <i class="fas fa-arrow-left mr-2"></i>Quitter le tirage
      </button>

      <!-- INTRO -->
        <div id="tore-intro" class="relative z-10 text-center flex flex-col items-center">
        <h2 class="cormorant text-2xl text-gold mb-4">Préparation du tirage du TORE</h2>
        <p class="text-light-gold mb-6 max-w-2xl mx-auto">
          Nous avons besoin de quelques informations pour calibrer l’expérience.
        </p>
        <button id="tore-start" class="btn-gold mt-4">Commencer le tirage</button>
      </div>

      <!-- FORMULAIRE AVANT LE PLATEAU -->
      <form id="tore-form" class="hidden relative z-10 mt-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label class="block text-light-gold mb-2">Prénoms</label>
            <input type="text" name="prenom"
                   class="w-full bg-[rgba(5,20,40,7)] border border-[rgba(212,175,55,35)] p-3 rounded-lg"
                   required>
          </div>
          <div>
            <label class="block text-light-gold mb-2">Date de naissance</label>
            <input type="date" name="date"
                   class="w-full bg-[rgba(5,20,40,7)] border border-[rgba(212,175,55,35)] p-3 rounded-lg"
                   required>
          </div>
          <div>
            <label class="block text-light-gold mb-2">Ville de naissance</label>
            <input type="text" name="ville"
                   class="w-full bg-[rgba(5,20,40,7)] border border-[rgba(212,175,55,35)] p-3 rounded-lg"
                   required>
          </div>
          <div>
            <label class="block text-light-gold mb-2">Heure de naissance</label>
            <input type="time" name="heure"
                   class="w-full bg-[rgba(5,20,40,7)] border border-[rgba(212,175,55,35)] p-3 rounded-lg"
                   required>
          </div>
        </div>
        <div class="mb-6">
          <label class="block text-light-gold mb-2">Renseignez votre intention pour ce tirage</label>
          <textarea name="intention"
                    class="w-full bg-[rgba(5,20,40,7)] border border-[rgba(212,175,55,35)] p-3 rounded-lg min-h-[120px]"
                    required></textarea>
        </div>
        <button type="submit" class="btn-gold w-full">Lancer le tirage du TORE</button>
      </form>

      <!-- PLATEAU – 7 TAS EN MODE SIX-POINTS -->
      <div id="tore-board" class="hidden relative z-10 mt-10">
        <h3 class="cormorant text-2xl text-gold mb-6 text-center">
          Retournez les 7 cartes du Tore puis lancez la pièce 6 fois.
        </h3>
        <div class="tore-board-7">

          <!-- Les cartes sont générées par le script ci-dessous -->
        </div>
      </div>

       <!-- PIÈCE DE TIRAGE -->
      <div id="tore-coin-wrapper"
     class="hidden absolute inset-0 flex flex-col-reverse items-center justify-center z-40 pointer-events-none">
<style>
#tore-coin-wrapper {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -38%); /* ajuste la position verticale du bloc pièce+bouton */
  pointer-events: none;
}

#tore-coin-button {
  pointer-events: auto;
  margin-top: 20px; /* bouton SOUS la pièce */
}

#tore-coin {
  pointer-events: auto;
  margin-bottom: 10px;
}
</style>

        <button id="tore-coin-button" class="btn-gold">
          Lancer la pièce de tirage
        </button>
        <button id="tore-to-analysis" class="btn-gold hidden">
  Voir l’analyse du tirage
</button>

        <div id="tore-coin"
             class="tore-coin face-yang"
             aria-label="Pièce de tirage Oradia">
        </div>
      </div>

      <!-- Flèche coin → carte -->
      <div id="tore-arrow"></div>

      <!-- Aperçu zoom d'une carte retournée -->
      <div id="card-preview-overlay">
  <img id="card-preview-img" src="" alt="Aperçu de la carte">
</div>


      <!-- RÉSULTATS TEXTE -->
      <div id="tore-results" class="hidden relative z-10 mt-10">
        <!-- DeepSite peut injecter ici le rendu détaillé (texte, synthèse, etc.) -->
      </div>
    </div>
  </div>
</section>
<script>
// --------- Données cartes ----------
window.DATA = {

  // ▲ = yang (triangle) • ● = yin (cercle)

  emotions: [
    {name:"JOIE",           quote:"L’onde éclate, la lumière danse dans ton cœur.", polarity:"yang"},
    {name:"TRISTESSE",      quote:"La pluie descend, lavant la mémoire des pierres.", polarity:"yin"},
    {name:"AMOUR",          quote:"Le souffle relie, un fil invisible circule.", polarity:"yang"},
    {name:"SOLITUDE",       quote:"Le silence s’installe comme une montagne.", polarity:"yin"},
    {name:"ÉMERVEILLEMENT", quote:"L’enfant intérieur ouvre grand ses yeux.", polarity:"yang"},
    {name:"DÉGOÛT",         quote:"Le corps rejette ce qui empoisonne.", polarity:"yin"},
    {name:"SÉRÉNITÉ",       quote:"L'eau se clarifie et reflète désormais le monde sans le déformer.", polarity:"yang"},
    {name:"DOUTE",          quote:"La brume recouvre la vallée.", bridge:"Habiter la question en attendant la clarté.", polarity:"yin"},
    {name:"COLÈRE",         quote:"Le feu jaillit, brisant les chaînes.", polarity:"yang"},
    {name:"INJUSTICE",      quote:"La balance penche, l’équité s’efface.", polarity:"yin"},
    {name:"COURAGE",        quote:"Le pas tremblant franchit la ligne.", polarity:"yang"},
    {name:"PEUR",           quote:"L’animal se fige aux lisières.", polarity:"yin"},
    {name:"CONFIANCE",      quote:"L’arbre se dresse, enraciné vers la lumière.", polarity:"yang"},
    {name:"HONTE",          quote:"Le visage se cache sous le voile.", polarity:"yin"},
    {name:"FIERTÉ",         quote:"Ce que tu as traversé te rend stable, solide et vrai.", polarity:"yang"},
    {name:"CULPABILITÉ",    quote:"Une lourdeur s'installe, née d'un pas mal posé.", bridge:"Rendre ce qui n’est pas sien et s’alléger.", polarity:"yin"},
    {name:"IMPATIENCE",     quote:"Le cheval piaffe avant l’aube.", polarity:"yang"},
    {name:"PATIENCE",       quote:"Le fruit mûrit dans l’ombre.", polarity:"yin"},
  ],

  besoins: [
    {name:"RECONNAISSANCE", quote:"Le bourgeon éclot quand il est vu.", polarity:"yang"},
    {name:"SÉCURITÉ",       quote:"Le foyer s’allume, le feu crépite.", polarity:"yin"},
    {name:"LIBERTÉ",        quote:"Le vent brise les clôtures invisibles.", polarity:"yang"},
    {name:"SOUTIEN",        quote:"Deux troncs s’appuient et forment un arc.", polarity:"yin"},
    {name:"REPOS",          quote:"Le corps se dépose, la rivière s’apaise.", polarity:"yin"},
    {name:"CLARETÉ",        quote:"Le soleil perce la brume.", polarity:"yang"},
    {name:"APPARTENANCE",   quote:"Le cercle s’ouvre pour accueillir.", polarity:"yin"},
    {name:"AUTONOMIE",      quote:"La tige se redresse seule.", polarity:"yang"},
    {name:"STIMULATION",    quote:"L’étincelle jaillit et anime la marche.", polarity:"yang"},
    {name:"HARMONIE",       quote:"La lyre vibre de cordes accordées.", polarity:"yin"},
    {name:"AMOUR REÇU",     quote:"Le cœur s’ouvre comme une coupe.", polarity:"yang"},
    {name:"LE SENS",        quote:"La marche trace un sillon vers le tout.", polarity:"yin"},
    {name:"PROTECTION",     quote:"Le manteau couvre de chaleur.", polarity:"yin"},
    {name:"EXPANSION",      quote:"L’horizon s’élargit et appelle.", polarity:"yang"},
    {name:"INTIMITÉ",       quote:"L’alcôve garde le secret des âmes.", polarity:"yin"},
    {name:"CRÉATIVITÉ",     quote:"L’étincelle façonne une forme neuve.", polarity:"yang"},
    {name:"VÉRITÉ",         quote:"Le miroir reflète sans détour.", polarity:"yin"},
    {name:"GUIDANCE",       quote:"L’étoile brille au-dessus du chemin.", polarity:"yang"},
  ],

  transmutation: [
    {name:"ACCEPTATION",   quote:"La pierre immobile se laisse sculpter par la rivière.", polarity:"yin"},
    {name:"TRANSFORMATION",quote:"Le feu consume et révèle la braise d’or.", polarity:"yang"},
    {name:"LÂCHER-PRISE",  quote:"La feuille tombe et nourrit la terre.", polarity:"yin"},
    {name:"RECADRAGE",     quote:"Le miroir change d’angle et tout se déplace.", polarity:"yang"},
    {name:"PARDON",        quote:"Les chaînes brisées rouillent au sol.", polarity:"yin"},
    {name:"ALIGNEMENT",    quote:"Les astres s’ordonnent sur un axe commun.", polarity:"yang"},
    {name:"DÉTACHEMENT",   quote:"L’oiseau s’élève sans s’accrocher aux branches.", polarity:"yin"},
    {name:"PURIFICATION",  quote:"L’eau claire traverse la roche.", polarity:"yang"},
    {name:"ANCRAGE",       quote:"Les racines plongent dans le sol fertile.", polarity:"yin"},
    {name:"OUVERTURE",     quote:"La porte s’entrouvre, la lumière jaillit.", polarity:"yang"},
    {name:"FLUIDITÉ",      quote:"La rivière contourne l’obstacle sans effort.", polarity:"yin"},
    {name:"CLARIFICATION", quote:"L'essentiel apparait dans la lumière retrouvée.", polarity:"yang"},
    {name:"SILENCE",       quote:"Le vide sonore abrite l’invisible.", polarity:"yin"},
    {name:"EXPRESSION",    quote:"La parole jaillit comme source claire.", polarity:"yang"},
    {name:"VIDE",          quote:"La coupe vide attend d’être remplie.", polarity:"yin"},
    {name:"PLENITUDE",     quote:"Le vase déborde de miel et d’offrandes.", polarity:"yang"},
    {name:"INCARNATION",   quote:"Le pas touche la terre lourde.", polarity:"yin"},
    {name:"TRANSCENDANCE", quote:"L’aigle s’élève au-delà des nuées.", polarity:"yang"},
  ],

  archetypes: [
    {name:"MERLIN",         quote:"Le vieil arbre garde les secrets des âges.", polarity:"yin"},
    {name:"DRAGON ROUGE",   quote:"Le souffle ardent défend la vie.", polarity:"yang"},
    {name:"DRAGON BLANC",   quote:"Le gardien veille au seuil des mystères.", polarity:"yang"},
    {name:"LA CUVE",        quote:"Le creuset accueille le feu caché.", polarity:"yin"},
    {name:"SAINT-MICHEL",   quote:"L’épée fend le voile de l’illusion.", polarity:"yang"},
    {name:"LA COLLINE",     quote:"Du sommet, l’horizon se déploie.", polarity:"yin"},
    {name:"LE SAGE",        quote:"Le silence enseigne plus que mille mots.", polarity:"yin"},
    {name:"LE GUERRIER",    quote:"Le cœur frappe avec droiture.", polarity:"yang"},
    {name:"L’ALCHIMISTE",   quote:"Le plomb rêve de devenir or.", polarity:"yin"},
    {name:"LE BÂTISSEUR",   quote:"La pierre dressée trace l’ordre.", polarity:"yang"},
    {name:"LA PRÊTRESSE",   quote:"Le voile garde l’accès au mystère.", polarity:"yin"},
    {name:"LE VOYAGEUR",    quote:"Le pas ouvre la route inconnue.", polarity:"yang"},
    {name:"LE NOMADE",         quote:"Le pas sans fin cherche l’horizon.", polarity:"yang"},
    {name:"LA MATRICE",        quote:"Le ventre secret abrite le monde.", polarity:"yin"},
    {name:"LE REVEUR",         quote:"L’œil fermé voit d’autres mondes.", polarity:"yin"},
    {name:"LE VISIONNAIRE",    quote:"Le regard perce les âges à venir.", polarity:"yang"},
    {name:"LE GARDIEN DU FEU", quote:"La flamme veille au centre de la nuit.", polarity:"yang"},
    {name:"LA TISSEUSE",       quote:"Le fil relie les morceaux épars.", polarity:"yin"},
  ],

  revelations: [
    {name:"CLÉ",          quote:"L’objet caché ouvre la chambre secrète.", polarity:"yang"},
    {name:"PORTE",        quote:"L’ouverture se dessine dans le mur.", polarity:"yin"},
    {name:"MESSAGE",      quote:"Le souffle apporte un signe audible.", polarity:"yang"},
    {name:"SYNCHRONICITÉ",quote:"Les fils invisibles se répondent.", polarity:"yin"},
    {name:"SIGNE",        quote:"Un éclat discret scintille sur le chemin.", polarity:"yin"},
    {name:"VISION",       quote:"L’œil perce au-delà des voiles.", polarity:"yang"},
    {name:"PRÉSAGE",      quote:"Un souffle d’avenir traverse le présent.", polarity:"yin"},
    {name:"ÉVEIL",        quote:"L’esprit se souvient de lui-même.", polarity:"yang"},
    {name:"LUMIÈRE",      quote:"Un rayon fend l’ombre.", polarity:"yang"},
    {name:"DÉVOILEMENT",  quote:"Le rideau s’écarte, la scène surgit.", polarity:"yin"},
    {name:"VÉRITÉ",       quote:"Le voile tombe, l’essence apparaît.", polarity:"yang"},
    {name:"ILLUSION",     quote:"L’image trompe et captive.", polarity:"yin"},
    {name:"ÉTINCELLE",    quote:"Le feu naît d’une poussière de pierre.", polarity:"yang"},
    {name:"SILENCE",      quote:"L’absence de bruit révèle l’essentiel.", polarity:"yin"},
    {name:"CHIFFRE",      quote:"Le nombre ordonne l’univers caché.", polarity:"yang"},
    {name:"SYMBOLE",      quote:"L’image muette parle au cœur.", polarity:"yin"},
    {name:"ORIGINE",      quote:"La source coule en amont de tout.", polarity:"yin"},
    {name:"DESTIN",       quote:"La flèche vole vers son but.", polarity:"yang"},
  ],

  actions: [
    {name:"AGIR",        quote:"La graine pousse en sortant de terre.", polarity:"yang"},
    {name:"ÉCOUTER",     quote:"L’oreille se penche sur le murmure.", polarity:"yin"},
    {name:"DIRE",        quote:"La parole tranche comme un souffle clair.", polarity:"yang"},
    {name:"RECEVOIR",    quote:"Le cœur ouvert accueille le don.", polarity:"yin"},
    {name:"CRÉER",       quote:"Le geste façonne ce qui n’était pas.", polarity:"yang"},
    {name:"ACCUEILLIR",  quote:"La porte s’ouvre à l’inattendu.", polarity:"yin"},
    {name:"PARTAGER",    quote:"La coupe passe de main en main.", polarity:"yang"},
    {name:"PROTÉGER",    quote:"L’abri se dresse autour du fragile.", polarity:"yin"},
    {name:"ALLER VERS",  quote:"Le pas cherche la rencontre.", polarity:"yang"},
    {name:"SE RETIRER",  quote:"Le sage quitte la foule.", polarity:"yin"},
    {name:"CHOISIR",     quote:"Le carrefour appelle la décision.", polarity:"yang"},
    {name:"PATIENTER",   quote:"Le fruit mûrit lentement.", polarity:"yin"},
    {name:"PROCLAMER",   quote:"La voix s’élève dans l’assemblée.", polarity:"yang"},
    {name:"OBSERVER",    quote:"L’œil contemple sans agir.", polarity:"yin"},
    {name:"ORDONNER",    quote:"La main trace l’alignement des pierres.", polarity:"yang"},
    {name:"RÉCONCILIER", quote:"Les mains se rejoignent après la discorde.", polarity:"yin"},
    {name:"MANIFESTER",  quote:"La parole devient chair.", polarity:"yang"},
    {name:"ARRÊTER",     quote:"Le pas s’interrompt, la poussière retombe.", polarity:"yin"},
  ],

  memoire_cosmos: [
    {name:"ÉTOILE",      quote:"La voûte céleste inscrit la mémoire des mondes. Derrière leur éclat se cache la mémoire de l’infini."},
    {name:"TERRE",       quote:"Le sol garde les pas de ceux qui ont marché avant. Chaque pierre est une archive que ton corps sait lire."},
    {name:"OCÉAN",       quote:"Les vagues effacent et recommencent sans fin. Les profondeurs retiennent ce que la surface oublie."},
    {name:"GÉNÉALOGIE",  quote:"Tes racines prolongent des vies invisibles. Tu es à la fois héritage et commencement."},
    {name:"FUTUR",       quote:"La graine porte déjà l’ombre de la forêt. Chaque geste d’aujourd’hui écrit une prophétie."},
    {name:"PASSÉ",       quote:"Les échos d’hier résonnent dans le présent. Celui qui écoute peut en transformer la trame."},
    {name:"PRÉSENT",     quote:"Tout converge en un seul instant immobile. C’est là que s’ouvre la porte de tous les temps."},
    {name:"MÉMOIRE CELLULAIRE",  quote:"Chaque cellule conserve la trace du vivant. Le corps est une bibliothèque où rien ne se perd."},
    {name:"MÉMOIRE COLLECTIVE",  quote:"Le groupe rêve à travers l’individu. Dans la conscience partagée se tisse un monde commun."},
    {name:"LE TORE",     quote:"Le tore relie l’ombre et la lumière. De son cœur pulse la danse éternelle des cycles."},
   ],
};
</script>

<script>
(function () {
  const STEPS_TORE = [
    { key: 'emotions',      label: 'ÉMOTIONS',       chip: 'Émotion',         pos: 0 },
    { key: 'besoins',       label: 'BESOINS',        chip: 'Besoin',          pos: 1 },
    { key: 'transmutation', label: 'TRANSMUTATION',  chip: 'Transmutation',   pos: 2 },
    { key: 'actions',       label: 'ACTIONS',        chip: 'Action',          pos: 3 },
    { key: 'archetypes',    label: 'ARCHÉTYPE',      chip: 'Archétype',       pos: 4 },
    { key: 'revelations',   label: 'RÉVÉLATION',     chip: 'Révélation',      pos: 5 },
    { key: 'memoire_cosmos',label: 'MÉMOIRE COSMOS', chip: 'Mémoire Cosmos',  pos: 6 },
  ];
  // Famille de passerelle en cas de différence carte / pièce
  const BRIDGE_TARGET = {
    emotions:      'transmutation',
    transmutation: 'revelations',
    revelations:   'actions',
    actions:       'archetypes',
    archetypes:    'besoins',
    besoins:       'emotions',
    // memoire_cosmos: pas de passerelle
  };

// Dossier d'images par famille
  const FAMILY_FOLDERS = {
    emotions: 'emotions',
    besoins: 'besoins',
    transmutation: 'transmutations',
    actions: 'actions',
    archetypes: 'archetypes',
    revelations: 'revelations',
    memoire_cosmos: 'memoire_cosmos',
  };
const BACK_IMAGES = {
  emotions: 'images/dos/dos_emotion.png',
  besoins: 'images/dos/dos_besoin.png',
  transmutation: 'images/dos/dos_transmutation.png',
  actions: 'images/dos/dos_action.png',
  archetypes: 'images/dos/dos_archetype.png',
  revelations: 'images/dos/dos_revelation.png',
  memoire_cosmos: 'images/dos/dos_memoire_cosmos.png',
};

  const FAMILY_ORDER = STEPS_TORE.map(s => s.key); // ordre horaire
  let arrowEl = null;
  let arrowHideTimer = null;
  let lastCoinResult = null;

  const el = id => document.getElementById(id);

// État du tirage de la pièce : 1 lancer par famille SAUF memoire_cosmos (pas de polarité, pas de lancer)
let toreThrowIndex = 0;                       // 0 → 5 (6 lancers)

  const toreBridgeAdded = new Array(STEPS_TORE.length).fill(false);

  const section   = el('tore-immersif');
  if (!section) return;

  const intro     = el('tore-intro');
  const form      = el('tore-form');
  const boardWrap = el('tore-board');
  const boardHost = boardWrap?.querySelector('.tore-board-7');
  const results   = el('tore-results');
  const startBtn  = el('tore-start');
  const exitBtn   = el('exitToreBtn');
  let toreHasStarted = false;
  const previewOverlay = el('card-preview-overlay');
  const previewImg     = el('card-preview-img');
  const coinWrapper = el('tore-coin-wrapper');
  const coin = el('tore-coin');
  const coinButton = el('tore-coin-button');
  const toAnalysisBtn = el('tore-to-analysis');  

// --- helpers ---

 function showToreAnalysisCTA() {
  if (!coinWrapper) return;

  // cacher la pièce + bouton de lancer
  coin?.classList.add('hidden');
  coinButton?.classList.add('hidden');

  // afficher le CTA analyse
  toAnalysisBtn?.classList.remove('hidden');

  // on garde le wrapper visible
  coinWrapper.classList.remove('hidden');
}

  function pickFromData(familyKey) {
    const pool = Array.isArray(window.DATA?.[familyKey]) ? window.DATA[familyKey] : [];
    if (!pool.length) return null;
    const idx = Math.floor(Math.random() * pool.length);
    return pool[idx] || null;
  }

  function slugifyName(name) {
    return (name || '')
      .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // supprime les accents
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '_')                     // TOUT ce qui n’est pas lettre/chiffre devient "_"
      .replace(/^_+|_+$/g, '');                        // enlève les "_" en trop au début/fin
  }

  function buildImagePath(familyKey, data) {
    const folder = FAMILY_FOLDERS[familyKey] || familyKey;
    let file = (data && data.file) ? String(data.file) : '';

// Si un chemin explicite est fourni (cosmos par ex.)
    if (file.includes('/')) {
      if (file.startsWith('./') || file.startsWith('images/')) return file;
      return 'images/' + file.replace(/^\/+/, '');
    }

// Sinon on déduit le nom du fichier à partir du nom de la carte
    if (!file) {
      const slug = slugifyName(data?.name || '');
      file = slug + '.png';
    }

    return `images/${folder}/${file}`;
  }
  function ensureArrowElement() {
    if (arrowEl) return arrowEl;
    arrowEl = document.getElementById('tore-arrow');
    if (!arrowEl) {
      arrowEl = document.createElement('div');
      arrowEl.id = 'tore-arrow';
      document.body.appendChild(arrowEl);
    }
    return arrowEl;
  }

  function addExtraCardForFamily(familyKey) {
    if (!boardHost) return;

    const currentIndex = FAMILY_ORDER.indexOf(familyKey);
    if (currentIndex === -1) return;

    const nextFamilyKey = FAMILY_ORDER[(currentIndex + 1) % FAMILY_ORDER.length];
    const hostArticle = boardHost.querySelector(`.tore-card[data-family="${nextFamilyKey}"]`);
    if (!hostArticle) return;

    const data = pickFromData(nextFamilyKey);
    if (!data) return;

    const imgPath = buildImagePath(nextFamilyKey, data);

    let extraWrap = hostArticle.querySelector('.tore-extra-cards');
    if (!extraWrap) {
      extraWrap = document.createElement('div');
      extraWrap.className = 'tore-extra-cards';
      hostArticle.appendChild(extraWrap);
    }

    const extraImg = document.createElement('img');
    extraImg.src = imgPath;
    extraImg.alt = data.name || '';
    extraImg.className = 'tore-extra-card';
    extraWrap.appendChild(extraImg);

    requestAnimationFrame(() => {
      extraImg.classList.add('show');
    });
  }

  function animateArrowToCard(card) {
    if (!coin) return;
    const arrow = ensureArrowElement();
    if (!arrow) return;

    const coinRect = coin.getBoundingClientRect();
    const targetEl = card.querySelector('.polarity-marker') || card;
    const targetRect = targetEl.getBoundingClientRect();

    const startX = coinRect.left + coinRect.width / 2;
    const startY = coinRect.top + coinRect.height / 2;
    const endX   = targetRect.left + targetRect.width / 2;
    const endY   = targetRect.top + targetRect.height / 2;

    const dx = endX - startX;
    const dy = endY - startY;

    const distance = Math.sqrt(dx*dx + dy*dy);
    const angleDeg = Math.atan2(dy, dx) * 180 / Math.PI;

    arrow.style.left = `${startX}px`;
    arrow.style.top  = `${startY}px`;
    arrow.style.width = `${distance}px`;
    arrow.style.transform = `rotate(${angleDeg}deg)`;
    arrow.style.opacity = '1';

if (arrowHideTimer) clearTimeout(arrowHideTimer);
arrowHideTimer = setTimeout(() => {
  arrow.style.opacity = '0';
}, 900);

  }

  function processCoinResult(polarity) {
    if (!boardHost) return;
    lastCoinResult = polarity;

    const cards = Array.from(boardHost.querySelectorAll('.tore-card.flipped'));
    if (!cards.length) return;

    // reset visuel précédent
    cards.forEach(card => card.classList.remove('match', 'mismatch'));

    cards.forEach((card, index) => {
      const delay = index * 650;

      setTimeout(() => {
        animateArrowToCard(card);

        const cardPol = (card.dataset.polarity || '').toLowerCase();
        const isMatch = cardPol && cardPol === polarity;

        if (isMatch) {
          card.classList.add('match');
        } else {
          card.classList.add('mismatch');
          if (card.dataset.family) {
            addExtraCardForFamily(card.dataset.family);
          }
        }
      }, delay);
    });
  }

  function enterImmersiveTore () {
    document.body.classList.add('hide-immersive-tore');
    exitBtn.classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function exitImmersiveTore () {
    document.body.classList.remove('hide-immersive-tore');
    exitBtn.classList.add('hidden');

    intro.classList.remove('hidden');
    form.classList.add('hidden');
    boardWrap.classList.add('hidden');
    if (boardHost) boardHost.innerHTML = '';
    results.classList.add('hidden');
    results.innerHTML = '';
  }
// --- MODALE ORADIA : confirmation quitter (comme Pèlerin) ---
function ensureToreExitModal(){
  if (el('toreExitModal')) return;

  const modal = document.createElement('div');
  modal.id = 'toreExitModal';
  modal.className = 'hidden fixed inset-0 z-[300] items-center justify-center bg-night-blue/80';
  modal.style.backdropFilter = 'blur(6px)';

  modal.innerHTML = `
    <div class="w-[92vw] max-w-xl rounded-2xl border border-gold/30 shadow-2xl"
         style="background:linear-gradient(145deg, rgba(26,54,93,0.88), rgba(5,20,40,0.92));">
      <div class="p-6 border-b border-gold/20 flex items-start justify-between gap-4">
        <div>
          <div class="cormorant text-2xl md:text-3xl font-bold gold-gradient">Quitter le tirage ?</div>
          <div class="text-light-gold mt-2">Ton tirage en cours sera perdu.</div>
        </div>
        <button id="toreExitClose" class="text-gold text-2xl leading-none" aria-label="Fermer">×</button>
      </div>

      <div class="p-6 flex flex-col md:flex-row gap-3 md:justify-end">
        <button id="toreExitCancel"
                class="px-5 py-3 rounded-xl border border-gold/40 text-gold hover:bg-gold hover:text-night-blue transition">
          Annuler
        </button>
        <button id="toreExitConfirm" class="btn-gold px-6 py-3 rounded-xl">
          Oui, quitter
        </button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);

  // click backdrop = annuler
  modal.addEventListener('click', (e)=>{
    if (e.target === modal) closeToreExitModal();
  });

  modal.querySelector('#toreExitClose')?.addEventListener('click', closeToreExitModal);
  modal.querySelector('#toreExitCancel')?.addEventListener('click', closeToreExitModal);

  // ESC pour fermer
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape' && !modal.classList.contains('hidden')) closeToreExitModal();
  });
}

function openToreExitModal(onConfirm){
  const modal = el('toreExitModal');
  if(!modal) return;
  modal.classList.remove('hidden');
  modal.classList.add('flex');
  document.body.style.overflow = 'hidden';

  const confirmBtn = modal.querySelector('#toreExitConfirm');
  confirmBtn.onclick = () => {
    closeToreExitModal();
    onConfirm?.();
  };
}

function closeToreExitModal(){
  const modal = el('toreExitModal');
  if(!modal) return;
  modal.classList.add('hidden');
  modal.classList.remove('flex');
  document.body.style.overflow = '';
}

  function buildBoardTore () {
    if (!boardHost) return;
    
    // Reset de l'état du tirage de pièce
    toreThrowIndex = 0;
    for (let i = 0; i < toreBridgeAdded.length; i++) {
      toreBridgeAdded[i] = false;
    }

// Construction des 7 tas
        boardHost.innerHTML = STEPS_TORE.map(s => `
      <article class="tore-card pos-${s.pos}"
               data-family="${s.key}"
               aria-label="Carte ${s.label}">
        <div class="tore-card-inner">
          <div class="tore-card-back back" role="button" tabindex="0"
               aria-pressed="false" aria-label="Retourner la carte">
            <div class="logo-circle"></div>
          </div>
          <div class="tore-card-front">
            <div class="art">
              <div>
                <h3 data-name>—</h3>
                <p data-quote>—</p>
              </div>
            </div>
            <div class="bottom text-xs opacity-80 mt-2"></div>
          </div>
        </div>

        <!-- Label de famille sous la carte -->
        <div class="tore-family-label font-cinzel">
          ${s.label}
        </div>
      </article>
    `).join('');

    boardWrap.classList.remove('hidden');

// On cache la pièce au moment où on (re)lance un tirage
        if (coinWrapper) {
      coinWrapper.classList.add('hidden');
    }
    if (coin) {
      coin.classList.remove('spin', 'ripple', 'glow');
      coin.dataset.locked = '0';
    }


// Gestion du clic pour TOUTES les cartes 
    boardHost.querySelectorAll('.tore-card .tore-card-back').forEach(back => {
      const card = back.closest('.tore-card');
      if (!card) return;

      back.addEventListener('click', () => {
        if (card.classList.contains('flipped')) return;

        const famKey = (card.dataset.family || '').trim();
        const data   = pickFromData(famKey);
        const front  = card.querySelector('.tore-card-front');

        // On garde la polarité de la carte (yang / yin / none)
        const pol = (data && (data.polarity === 'yang' || data.polarity === 'yin'))
          ? data.polarity
          : 'none';
        card.dataset.polarity = pol;

        if (!data || !front) {
          card.classList.add('flipped');
          return;
        }
                const imgPath = buildImagePath(famKey, data);

        // on mémorise la polarité pour la comparaison avec la pièce
    

        front.style.padding = '0';
        front.style.background = 'none';

      front.innerHTML = `
  <img src="${imgPath}"
       alt="${data.name || ''}"
       style="
         width: 100%;
         height: 100%;
         object-fit: contain;
         display: block;
       " />
`;




        card.classList.add('flipped');

// Si toutes les cartes sont retournées, on affiche la pièce
        const totalCards   = boardHost.querySelectorAll('.tore-card').length;
        const flippedCards = boardHost.querySelectorAll('.tore-card.flipped').length;

                if (coinWrapper && totalCards > 0 && flippedCards === totalCards) {
          coinWrapper.classList.remove('hidden');
          if (coin) {
            coin.classList.remove('spin', 'ripple');
            coin.classList.add('glow');   // halo pulsant avant le lancer
          }
        }

      });
    });
    
// Aperçu zoom au survol des cartes déjà retournées
if (previewOverlay && previewImg) {
   boardHost.querySelectorAll('.tore-card').forEach(card => {

    card.addEventListener('mouseenter', (e) => {
      // On ne zoome que si la carte est déjà retournée
      if (!card.classList.contains('flipped')) return;

      let img = null;

      // 1) si on survole une carte passerelle, on zoome cette carte-là
      if (e.target && e.target.closest) {
        const extraImg = e.target.closest('.tore-card-extra')?.querySelector('img');
        if (extraImg) {
          img = extraImg;
        }
      }

      // 2) sinon, on zoome la carte principale
      if (!img) {
        img = card.querySelector('.tore-card-front img');
      }

      if (!img) return;

      previewImg.src = img.src;
      previewImg.alt = img.alt || '';
      previewOverlay.classList.add('card-preview-visible');
    });

    card.addEventListener('mouseleave', () => {
      previewOverlay.classList.remove('card-preview-visible');
    });
  });

}
  }
      // Pose réellement la carte passerelle (famille suivante) sur la pile concernée
  function placeBridgeCard(stepIndex, familyKey, dataNext) {
    if (!boardHost) return;
    if (toreBridgeAdded[stepIndex]) return;

    const currentStep = STEPS_TORE[stepIndex];
    const baseCard = boardHost.querySelector(`.tore-card[data-family="${currentStep.key}"]`);
    if (!baseCard) return;

    const imgPath = buildImagePath(familyKey, dataNext);

    const extra = document.createElement('div');
    extra.className = 'tore-card-extra';
    extra.innerHTML = `
      <img src="${imgPath}" alt="${dataNext.name || ''}">
    `;

    baseCard.appendChild(extra);
        // Permettre le zoom sur la carte additionnelle comme sur les cartes principales
    const extraImg = extra.querySelector('img');
    if (previewOverlay && previewImg && extraImg) {
      extraImg.addEventListener('mouseenter', () => {
        previewImg.src = extraImg.src;
        previewImg.alt = extraImg.alt || '';
        previewOverlay.classList.add('card-preview-visible');
      });

      extraImg.addEventListener('mouseleave', () => {
        previewOverlay.classList.remove('card-preview-visible');
      });
    }

    toreBridgeAdded[stepIndex] = true;
  }

  function getFamilyLabel(key) {
    const s = STEPS_TORE.find(step => step.key === key);
    return s ? s.label : key;
  }

  // Ouvre un overlay avec un éventail de cartes : l'utilisateur choisit sa passerelle
  function openBridgeFan(stepIndex, nextFamilyKey) {
    if (!boardHost) return;

    // on évite les doublons d'overlay
    const existing = document.getElementById('tore-extra-overlay');
    if (existing) existing.remove();

    const famLabel = getFamilyLabel(nextFamilyKey);

    const overlay = document.createElement('div');
    overlay.id = 'tore-extra-overlay';
    overlay.innerHTML = `
      <div class="tore-extra-panel">
        <h3>Carte passerelle</h3>
        <p>Choisis une carte dans la famille&nbsp;<strong>${famLabel}</strong>.</p>
        <div class="tore-extra-fan">
          <div class="tore-fan-card" data-slot="0"></div>
          <div class="tore-fan-card" data-slot="1"></div>
          <div class="tore-fan-card" data-slot="2"></div>
          <div class="tore-fan-card" data-slot="3"></div>
          <div class="tore-fan-card" data-slot="4"></div>
        </div>
             </div>
    `;

    document.body.appendChild(overlay);
// afficher les dos Oradia dans l'éventail
const back = BACK_IMAGES[nextFamilyKey];
overlay.querySelectorAll('.tore-fan-card').forEach(el => {
  if (back) {
    el.style.backgroundImage = `url("${back}")`;
    el.style.backgroundSize = 'cover';
    el.style.backgroundPosition = 'center';
  }
});

    // clic sur une des cartes de l'éventail
    overlay.querySelectorAll('.tore-fan-card').forEach(cardEl => {
      cardEl.addEventListener('click', () => {
        const dataNext = pickFromData(nextFamilyKey);
        if (dataNext) {
          placeBridgeCard(stepIndex, nextFamilyKey, dataNext);
        }
        overlay.remove();
      });
    });

    // bouton "Fermer" (au cas où)
    const btnCancel = overlay.querySelector('.tore-extra-cancel');
    if (btnCancel) {
      btnCancel.addEventListener('click', () => {
        overlay.remove();
      });
    }
  }


  // Affichage d'UNE seule flèche (la famille en cours) : pièce → carte
function showArrowForStep(stepIndex, isMatch) {
  if (!boardHost || !coin) return;
  const step = STEPS_TORE[stepIndex];
  if (!step) return;

  const card = boardHost.querySelector(`.tore-card[data-family="${step.key}"]`);
  if (!card) return;

  const arrow = ensureArrowElement();
  if (!arrow) return;

  // Couleur de la flèche : neutre (or) / match (vert) / mismatch (rouge)
  arrow.classList.remove('match', 'mismatch');
  if (isMatch === true) arrow.classList.add('match');
  else if (isMatch === false) arrow.classList.add('mismatch');

  animateArrowToCard(card);
}


      // Lancer la pièce de tirage : 1 lancer par famille, dans l'ordre STEPS_TORE
  function launchCoin() {
    if (!coin || !boardHost) return;

// On saute Mémoire Cosmos : pas de polarité → pas de tirage de pièce pour cette famille
while (toreThrowIndex < STEPS_TORE.length && STEPS_TORE[toreThrowIndex].key === 'memoire_cosmos') {
  toreThrowIndex += 1;
}

// Si plus rien à lancer → on remplace la pièce par le bouton Analyse
if (toreThrowIndex >= STEPS_TORE.length) {
  coin.classList.remove('glow');
  coin.dataset.locked = '1';
  showToreAnalysisCTA();
  return;
}


  // On ne lance la pièce que pour les familles avec polarité (Mémoire Cosmos exclue)

    if (toreThrowIndex >= STEPS_TORE.length) {
      return;
    }

    // Empêche plusieurs lancers simultanés
    if (coin.dataset.locked === '1') return;
    coin.dataset.locked = '1';

    // Famille concernée par ce lancer
    const stepIndex = toreThrowIndex;
    const step = STEPS_TORE[stepIndex];
    const card = boardHost.querySelector(`.tore-card[data-family="${step.key}"]`);
    const nextStepIndex = (stepIndex + 1) % STEPS_TORE.length;
    const nextStep = STEPS_TORE[nextStepIndex];

    // Plateau verrouillé pendant l’animation
    boardHost.classList.add('board-locked');

    // On enlève halo et onde précédents
    coin.classList.remove('glow', 'ripple', 'face-yang', 'face-yin');

    // Reset animation ripple
    void coin.offsetWidth;

    // Lancer d’animation de rotation
    coin.classList.add('spin');

    // Fin de l’animation (1s)
    setTimeout(() => {
      coin.classList.remove('spin');

      const isYang = Math.random() < 0.5;
      const coinPolarity = isYang ? 'yang' : 'yin';

      coin.classList.add(isYang ? 'face-yang' : 'face-yin');

      // Onde circulaire dorée
      coin.classList.remove('ripple');
      void coin.offsetWidth;
      coin.classList.add('ripple');

      // Vibration subtile du tore
      if (boardWrap) {
        boardWrap.classList.add('tore-shake');
        setTimeout(() => {
          boardWrap.classList.remove('tore-shake');
        }, 300);
      }

      // Comparaison avec la polarité de la carte
      if (card) {
        const cardPolarity = card.dataset.polarity || 'none';

        // pas de polarité (Mémoire Cosmos) → on montre juste une flèche neutre
        if (cardPolarity === 'none') {
         showArrowForStep(stepIndex, null);
        } else {
          const isMatch = (cardPolarity === coinPolarity);
          showArrowForStep(stepIndex, isMatch);

                   if (!isMatch) {
  // polarité différente → on laisse d'abord la flèche s'afficher
  setTimeout(() => {
    openBridgeFan(stepIndex, nextStep.key);
  }, 1000); // ajuste: 700 à 1200 selon l'effet désiré
}
        }
      }

      // Déverrouille le plateau
boardHost.classList.remove('board-locked');

// ✅ on passe à la famille suivante
toreThrowIndex += 1;

// ✅ on saute Mémoire Cosmos si on tombe dessus
while (toreThrowIndex < STEPS_TORE.length && STEPS_TORE[toreThrowIndex].key === 'memoire_cosmos') {
  toreThrowIndex += 1;
}

// ✅ si terminé après ce lancer → CTA tout de suite (pas besoin d’un clic en plus)
if (toreThrowIndex >= STEPS_TORE.length) {
  coin.classList.remove('glow');
  coin.dataset.locked = '1';
  showToreAnalysisCTA();
  return;
}

// Sinon, on réactive la pièce pour le lancer suivant
coin.dataset.locked = '0';
coin.classList.add('glow');

}, 1000);
}
  // --- listeners principaux ---

  startBtn?.addEventListener('click', () => {
    intro.classList.add('hidden');
    form.classList.remove('hidden');
  });

toAnalysisBtn?.addEventListener('click', () => {
  // afficher la zone résultats (si tu l'utilises pour l'analyse)
  results?.classList.remove('hidden');

  // scroll doux vers l'analyse
  results?.scrollIntoView({ behavior: 'smooth', block: 'start' });
});

 form?.addEventListener('submit', (e) => {
  e.preventDefault();
  form.classList.add('hidden');
  buildBoardTore();
  enterImmersiveTore();
  toreHasStarted = true;
  results.classList.add('hidden'); // DeepSite remplira plus tard
});

  if (coinButton) {
    coinButton.addEventListener('click', launchCoin);
  }

  if (coin) {
    // Optionnel : clic direct sur la pièce = même effet
    coin.addEventListener('click', launchCoin);
  }

  if (exitBtn && !exitBtn.dataset.bound) {
  exitBtn.dataset.bound = "1";

  exitBtn.addEventListener('click', () => {
    // Si un tirage a commencé → modale Oradia
    if (toreHasStarted) {
      ensureToreExitModal();
      openToreExitModal(() => {
        toreHasStarted = false;
        exitImmersiveTore();
        window.location.href = '/index.html#accueil';
      });
      return;
    }

    // Sinon : quitter direct
    exitImmersiveTore();
    window.location.href = '/index.html#accueil';
  });
}
})();
</script>

</footer>
  <script>
  const mobileBtn = document.getElementById("mobileMenuBtn");
  const mobileMenu = document.getElementById("mobileMenu");

  if (mobileBtn && mobileMenu) {
    mobileBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
  }
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  // MENU MOBILE
  const mobileBtn = document.getElementById("mobileMenuBtn");
  const mobileMenu = document.getElementById("mobileMenu");

  if (mobileBtn) {
    mobileBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
  }

  // MENU ESPACE MEMBRE
  const btn = document.getElementById("memberMenuBtn");
  const menu = document.getElementById("memberDropdown");

  if (btn && menu) {
    btn.addEventListener("click", () => {
      menu.classList.toggle("hidden");
    });

    document.addEventListener("click", (e) => {
      if (!btn.contains(e.target) && !menu.contains(e.target)) {
        menu.classList.add("hidden");
      }
    });
  }

});
</script>
<!-- Footer -->
  <footer class="py-12 px-6 bg-night-blue border-t border-gold/20">
    <div class="container mx-auto max-w-6xl">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
        <div>
          <div class="flex items-center mb-4">
            <img src="images/logo-hd-v2.jpeg" alt="Oradia Logo" class="w-16 h-16 mr-4" />
            <span class="cormorant text-3xl font-bold gold-gradient">ORADIA</span>
          </div>
          <p class="text-light-gold text-sm">L'oracle qui vous accompagne sur votre chemin personnel et révèle votre essence.</p>
        </div>
        <div>
          <h4 class="cormorant text-xl text-gold mb-4">Navigation</h4>
          <ul class="space-y-2">
            <li><a href="index.html#accueil" class="text-light-gold hover:text-gold transition">Accueil</a></li>
            <li><a href="index.html#oracle" class="text-light-gold hover:text-gold transition">Jeu</a></li>
            <li><a href="index.html#offres" class="text-light-gold hover:text-gold transition">Offres</a></li>
            <li><a href="index.html#apropos" class="text-light-gold hover:text-gold transition">À Propos</a></li>
            <li><a href="index.html#edolgor" class="text-light-gold hover:text-gold transition">Edolg'Or</a></li>
          </ul>
        </div>
        <div>
          <h4 class="cormorant text-xl text-gold mb-4">Légal</h4>
          <ul class="space-y-2">
            <li><button id="showCGU" class="text-light-gold hover:text-gold transition bg-transparent border-none p-0 cursor-pointer">CGU</button></li>
            <li><a href="#" class="text-light-gold hover:text-gold transition">Mentions Légales</a></li>
            <li><a href="#" class="text-light-gold hover:text-gold transition">Politique de Confidentialité</a></li>
          </ul>
        </div>
        <div>
          <h4 class="cormorant text-xl text-gold mb-4">Contact</h4>
          <ul class="space-y-2">
            <li class="flex items-start"><i class="fas fa-envelope text-gold mt-1 mr-3"></i><span class="text-light-gold">Oradia@protonmail.com</span></li>
            <li class="flex items-start"><i class="fab fa-instagram text-gold mt-1 mr-3"></i><span class="text-light-gold">@oradia_oracle</span></li>
          </ul>
        </div>
      </div>
      <div class="pt-8 border-t border-gold/10 text-center">
        <p class="text-light-gold text-sm">&copy; 2025 Oradia. Tous droits réservés. |
          <button id="footerLogin" class="text-gold hover:text-light-gold">Accès Dashboard</button>
        </p>
      </div>
    </div>
  </footer>
</body>
</html>
