<!-- ================== TIRAGE DU TORE – PAGE IMMERSIVE ================== -->

<style>
  /* Mode immersif : on cache le reste quand le tirage est lancé */
  body.hide-immersive-tore > header,
  body.hide-immersive-tore > footer,
  body.hide-immersive-tore > section:not(#tore-immersif) {
    display: none !important;
  }

  /* Fond étoilé pour l'immersion */
  body.hide-immersive-tore {
    background: radial-gradient(ellipse at center, #0a1a2f 0%, #050b18 100%);
    position: relative;
    overflow-x: hidden;
  }

  body.hide-immersive-tore::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,.8), transparent),
      radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,.6), transparent),
      radial-gradient(1px 1px at 90px 150px, rgba(255,255,255,.7), transparent),
      radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,.5), transparent),
      radial-gradient(1px 1px at 180px 120px, rgba(255,255,255,.8), transparent);
    background-repeat: repeat;
    background-size: 200px 200px;
    z-index: -1;
    animation: twinkle 4s ease-in-out infinite alternate;
  }

  @keyframes twinkle {
    0% { opacity: 0.3; }
    100% { opacity: 0.8; }
  }

  /* Plateau 7 tas façon photo "Six-Points" */
  #tore-immersif .tore-board-7 {
    display: grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    grid-template-rows: repeat(3, auto);
    gap: 24px;
    place-items: center;
    max-width: 1200px;
    margin: 0 auto;
  }
  /* Disposition des piles avec effets de brillance */
  #tore-immersif .tore-board-7 .pos-5 { grid-area: 1 / 1; }
  #tore-immersif .tore-board-7 .pos-3 { grid-area: 1 / 3; }

  #tore-immersif .tore-board-7 .pos-2 { grid-area: 2 / 1; }
  #tore-immersif .tore-board-7 .pos-6 { grid-area: 2 / 2; }
  #tore-immersif .tore-board-7 .pos-4 { grid-area: 2 / 3; }

  #tore-immersif .tore-board-7 .pos-0 { grid-area: 3 / 1; }
  #tore-immersif .tore-board-7 .pos-1 { grid-area: 3 / 3; }

  /* Effets de halo sur les positions importantes */
  #tore-immersif .tore-board-7 .pos-6 {
    position: relative;
  }

  #tore-immersif .tore-board-7 .pos-6::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 140%;
    height: 140%;
    background: radial-gradient(circle, rgba(212,175,55,0.15) 0%, transparent 70%;
    border-radius: 50%;
    z-index: -1;
    animation: pulse 3s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.1); }
  }
/* Cartes du TORE (structure proche de la Traversée) */
  .tore-card {
    width: min(280px, 80vw);
    height: 400px;
    perspective: 1200px;
    position: relative;
    transition: transform 0.3s ease;
  }

  .tore-card:hover {
    transform: translateY(-5px);
  }
@media (max-width: 860px) {
    #tore-immersif .tore-board-7 {
      grid-template-columns: 1fr;
      grid-template-rows: auto;
    }
    #tore-immersif .tore-board-7 .pos-0,
    #tore-immersif .tore-board-7 .pos-1,
    #tore-immersif .tore-board-7 .pos-2,
    #tore-immersif .tore-board-7 .pos-3,
    #tore-immersif .tore-board-7 .pos-4,
    #tore-immersif .tore-board-7 .pos-5,
    #tore-immersif .tore-board-7 .pos-6 {
      grid-area: auto;
    }
  }
  .tore-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 800ms cubic-bezier(.2,.65,.2,1), box-shadow .3s;
    border-radius: 20px;
    box-shadow: 
      0 25px 50px rgba(0,0,0,.5),
      0 0 0 1px rgba(212,175,55,0.1);
    overflow: hidden;
  }
.tore-card.flipped .tore-card-inner {
    transform: rotateY(180deg);
  }
  .tore-card-back,
  .tore-card-front {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid rgba(212,175,55,.6);
    box-shadow: inset 0 0 30px rgba(212,175,55,0.1);
  }
  .tore-card-back {
    background: 
      radial-gradient(circle at 20% 10%, rgba(245,231,161,.25), transparent 50%),
      radial-gradient(circle at 80% 90%, rgba(88,190,255,.2), transparent 50%),
      linear-gradient(145deg, #0a1429, #08152b, #050b18);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .tore-card-back::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(
      from 0deg,
      transparent,
      rgba(212,175,55,0.1),
      transparent,
      rgba(88,190,255,0.1),
      transparent
    );
    animation: rotate 10s linear infinite;
  }

  @keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  .tore-card-back .logo-circle {
    border-radius: 999px;
    padding: 12px 28px;
    border: 2px solid rgba(212,175,55,.8);
    color: #f5e7a1;
    letter-spacing: .18em;
    text-transform: uppercase;
    font-size: .85rem;
    font-weight: 600;
    background: rgba(5,20,40,0.7);
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 2;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(212,175,55,0.3);
  }

  .tore-card-back:hover .logo-circle {
    background: rgba(212,175,55,0.1);
    border-color: rgba(245,231,161,0.9);
    box-shadow: 0 12px 35px rgba(212,175,55,0.4);
    transform: scale(1.05);
  }
  .tore-card-front {
    transform: rotateY(180deg);
    background: 
      radial-gradient(circle at 20% 10%, rgba(245,231,161,.2), transparent 50%),
      radial-gradient(circle at 80% 90%, rgba(88,190,255,.15), transparent 50%),
      linear-gradient(145deg, #091a32, #020814, #050b18);
    display: flex;
    flex-direction: column;
    padding: 20px;
    color: #f9f7ef;
    position: relative;
    overflow: hidden;
  }

  .tore-card-front::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, transparent 40%, rgba(212,175,55,0.05), transparent 60%);
  }
  .tore-card-front .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: .85rem;
    margin-bottom: 16px;
    position: relative;
    z-index: 2;
  }
  .tore-card-front .chip {
    border-radius: 999px;
    border: 1px solid rgba(212,175,55,.9);
    padding: 6px 14px;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: .15em;
    font-size: .75rem;
    background: rgba(212,175,55,0.1);
    backdrop-filter: blur(5px);
  }
  .tore-card-front .polarity {
    font-size: 1.2rem;
    text-shadow: 0 0 10px rgba(212,175,55,0.5);
  }
  .tore-card-front .art {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 0 10px;
    position: relative;
    z-index: 2;
  }
  .tore-card-front [data-name] {
    font-family: "Cormorant Garamond", serif;
    font-size: 1.8rem;
    margin-bottom: .4rem;
    background: linear-gradient(135deg, #f5e7a1 0%, #d4af37 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 600;
  }
  .tore-card-front [data-quote] {
    font-size: 1rem;
    line-height: 1.5;
    opacity: .95;
    font-style: italic;
    max-width: 90%;
    margin: 0 auto;
  }
</style>
<section id="tore-immersif" class="py-24 px-6 bg-night-blue relative overflow-hidden">
<div class="container mx-auto max-w-6xl">
    <div class="text-center mb-12">
      <h1 class="cormorant text-4xl md:text-5xl font-bold mb-4 gold-gradient pb-1">
        Tirage du TORE
      </h1>
      <p class="text-light-gold max-w-3xl mx-auto">
        Guidance vibratoire complète – 7 familles, toutes les dimensions de votre être.
      </p>
    </div>
    <div class="rounded-3xl p-10 mb-8 relative overflow-hidden border-gold-glow"
         style="background:linear-gradient(145deg,rgba(26,54,93,.9),rgba(5,20,40,.95));">
      <!-- Bouton retour mode immersif avec effet amélioré -->
      <a href="index.html" id="exitToreBtn"
         class="fixed top-6 left-6 hidden z-50 bg-gradient-to-r from-gold to-light-gold text-night-blue font-bold px-6 py-3 rounded-xl shadow-2xl hovered-element transform transition-all duration-300 hover:scale-105">
        <i class="fas fa-arrow-left mr-2"></i>Quitter le tirage
      </a>
<!-- INTRO -->
      <div id="tore-intro" class="relative z-10">
        <h2 class="cormorant text-2xl text-gold mb-4">Préparation du tirage du TORE</h2>
        <p class="text-light-gold mb-6">
          Ce tirage complet explore les 7 familles de ton oracle. Nous avons besoin de quelques informations
          pour calibrer l’expérience.
        </p>
        <button id="tore-start" class="btn-gold">Commencer le tirage</button>
      </div>
      <!-- FORMULAIRE AVANT LE PLATEAU avec design amélioré -->
      <form id="tore-form" class="hidden relative z-10 mt-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
          <div class="form-group-gold">
            <label class="block text-light-gold mb-3 text-sm font-semibold tracking-wide">PRÉNOM</label>
            <input type="text" name="prenom"
                   class="w-full bg-[rgba(5,20,40,.8)] border border-[rgba(212,175,55,.5)] p-4 rounded-xl focus:ring-2 focus:ring-gold focus:border-transparent transition-all duration-300"
                   placeholder="Votre prénom..."
                   required>
          </div>
          <div class="form-group-gold">
            <label class="block text-light-gold mb-3 text-sm font-semibold tracking-wide">DATE DE NAISSANCE</label>
            <input type="date" name="date"
                   class="w-full bg-[rgba(5,20,40,.8)] border border-[rgba(212,175,55,.5)] p-4 rounded-xl focus:ring-2 focus:ring-gold focus:border-transparent transition-all duration-300"
                   required>
          </div>
          <div class="form-group-gold">
            <label class="block text-light-gold mb-3 text-sm font-semibold tracking-wide">VILLE DE NAISSANCE</label>
            <input type="text" name="ville"
                   class="w-full bg-[rgba(5,20,40,.8)] border border-[rgba(212,175,55,.5)] p-4 rounded-xl focus:ring-2 focus:ring-gold focus:border-transparent transition-all duration-300"
                   placeholder="Lieu de naissance..."
                   required>
          </div>
          <div class="form-group-gold">
            <label class="block text-light-gold mb-3 text-sm font-semibold tracking-wide">HEURE DE NAISSANCE</label>
            <input type="time" name="heure"
                   class="w-full bg-[rgba(5,20,40,.8)] border border-[rgba(212,175,55,.5)] p-4 rounded-xl focus:ring-2 focus:ring-gold focus:border-transparent transition-all duration-300"
                   required>
          </div>
        </div>
        <div class="mb-8">
          <label class="block text-light-gold mb-3 text-sm font-semibold tracking-wide">VOTRE INTENTION POUR CE TIRAGE COMPLET</label>
          <textarea name="intention"
                    class="w-full bg-[rgba(5,20,40,.8)] border border-[rgba(212,175,55,.5)] p-4 rounded-xl focus:ring-2 focus:ring-gold focus:border-transparent transition-all duration-300 min-h-[140px] resize-none"
                    placeholder="Formulez ici votre intention vibratoire..."
                    required></textarea>
        </div>
        <button type="submit" class="btn-gold-glow text-lg w-full py-4">Lancer le tirage sacré du TORE</button>
      </form>
      <!-- PLATEAU – 7 TAS EN MODE SIX-POINTS avec titre amélioré -->
      <div id="tore-board" class="hidden relative z-10 mt-12">
        <h3 class="cormorant text-3xl text-gold mb-8 text-center">
          Retournez les 7 Cartes Sacrées du TORE
        </h3>
        <div class="tore-board-7">

          <!-- Les cartes sont générées par le script ci-dessous -->
        </div>
      </div>
      <!-- RÉSULTATS TEXTE avec design amélioré -->
      <div id="tore-results" class="hidden relative z-10 mt-12">
        <!-- DeepSite peut injecter ici le rendu détaillé (texte, synthèse, etc.) -->
      </div>
</div>
  </div>
</section>

<script>
(function () {
  const STEPS_TORE = [
    { key: 'emotions',      label: 'ÉMOTIONS',       chip: 'Émotion',         pos: 0 },
    { key: 'besoins',       label: 'BESOINS',        chip: 'Besoin',          pos: 1 },
    { key: 'transmutation', label: 'TRANSMUTATION',  chip: 'Transmutation',   pos: 2 },
    { key: 'actions',       label: 'ACTIONS',        chip: 'Action',          pos: 3 },
    { key: 'archetypes',    label: 'ARCHÉTYPE',      chip: 'Archétype',       pos: 4 },
    { key: 'revelations',   label: 'RÉVÉLATION',     chip: 'Révélation',      pos: 5 },
    { key: 'cosmos',        label: 'MÉMOIRE COSMOS', chip: 'Mémoire Cosmos',  pos: 6 }
  ];
  // Ajout de styles CSS supplémentaires pour les nouveaux effets
  const style = document.createElement('style');
  style.textContent = `
    .form-group-gold input,
    .form-group-gold textarea {
      transition: all 0.3s ease;
    }
    
    .form-group-gold input:focus,
    .form-group-gold textarea:focus {
      box-shadow: 0 0 0 3px rgba(212,175,55,0.2);
      border-color: rgba(212,175,55,0.8);
    }
    
    .border-gold-glow {
      border: 1px solid rgba(212,175,55,0.4);
      box-shadow: 0 0 30px rgba(212,175,55,0.15);
    }
    
    .btn-gold-glow {
      background: linear-gradient(135deg, #d4af37 0%, #f5e7a1 100%);
      color: #050b18;
      border: none;
      font-weight: 700;
      letter-spacing: 0.05em;
      box-shadow: 0 8px 25px rgba(212,175,55,0.4);
      transition: all 0.3s ease;
    }
    
    .btn-gold-glow:hover {
      box-shadow: 0 12px 35px rgba(212,175,55,0.6);
      transform: translateY(-2px);
    }
  `;
  document.head.appendChild(style);

  const $  = s => document.querySelector(s);
  const el = id => document.getElementById(id);

  const section   = el('tore-immersif');
  if (!section) return;

  const intro     = el('tore-intro');
  const form      = el('tore-form');
  const boardWrap = el('tore-board');
  const boardHost = boardWrap?.querySelector('.tore-board-7');
  const results   = el('tore-results');
  const startBtn  = el('tore-start');
  const exitBtn   = el('exitToreBtn');
function enterImmersiveTore () {
    document.body.classList.add('hide-immersive-tore');
    exitBtn.classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  function exitImmersiveTore () {
    document.body.classList.remove('hide-immersive-tore');
    exitBtn.classList.add('hidden');
    // reset léger – libre à DeepSite de faire plus
    intro.classList.remove('hidden');
    form.classList.add('hidden');
    boardWrap.classList.add('hidden');
    boardHost.innerHTML = '';
    results.classList.add('hidden');
    results.innerHTML = '';
  }

  function buildBoardTore () {
    if (!boardHost) return;

    boardHost.innerHTML = STEPS_TORE.map(s => `
      <article class="tore-card pos-${s.pos}"
               data-family="${s.key}"
               aria-label="Carte ${s.label}">
        <div class="tore-card-inner">
          <div class="tore-card-back back" role="button" tabindex="0"
               aria-pressed="false" aria-label="Retourner la carte">
            <div class="logo-circle">TORE</div>
          </div>
          <div class="tore-card-front">
            <div class="topbar">
              <span class="chip">${s.chip}</span>
              <span class="polarity" data-polarity></span>
            </div>
            <div class="art">
              <div>
                <h3 data-name>—</h3>
                <p data-quote>—</p>
              </div>
            </div>
            <div class="bottom"></div>
          </div>
        </div>
      </article>
    `).join('');

    boardWrap.classList.remove('hidden');

    // comportement de base : flip au clic (DeepSite peut ensuite plugger l’API)
    boardHost.querySelectorAll('.tore-card .tore-card-back')
      .forEach(back => {
        back.addEventListener('click', () => {
          const card = back.closest('.tore-card');
          card.classList.add('flipped');
        });
      });
  }

  // listeners
  startBtn?.addEventListener('click', () => {
    intro.classList.add('hidden');
    form.classList.remove('hidden');
  });

  form?.addEventListener('submit', (e) => {
    e.preventDefault();
    form.classList.add('hidden');
    enterImmersiveTore();
    buildBoardTore();
    results.classList.add('hidden'); // à remplir après appel API
  });

  exitBtn?.addEventListener('click', exitImmersiveTore);
})();
</script>
